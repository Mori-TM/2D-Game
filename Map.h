#define TILE_SIZE 32
#define TILE_COUNT 81
glImage Tiles[TILE_COUNT];

int MapX = 32;
int MapY = 18;
int MapSize = 576;

unsigned char Map[] =
{
	255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 003, 004, 004, 005, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 014, 013, 013, 016, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 014, 013, 013, 016, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	255, 255, 014, 013, 013, 016, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
	004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004, 004,
};

#define SPRITE_COUNT 13
Sprite Sprites[SPRITE_COUNT];

void MapInit()
{
	FILE* File = fopen("Map.txt", "rb");
	if (File)
	{
		fread(Map, 1, MapSize, File);
		fclose(File);
	}	

	Sprites[0] = SpriteLoad("Sprites/AnimatedObjects/Card.bmp", 8, true);
	Sprites[1] = SpriteLoad("Sprites/AnimatedObjects/Chest.bmp", 8, true);
	Sprites[2] = SpriteLoad("Sprites/AnimatedObjects/Entry.bmp", 8, true);
	Sprites[3] = SpriteLoad("Sprites/AnimatedObjects/Hammer.bmp", 8, true);
	Sprites[4] = SpriteLoad("Sprites/AnimatedObjects/Money.bmp", 6, true);
	Sprites[5] = SpriteLoad("Sprites/AnimatedObjects/Platform.bmp", 8, true);
	Sprites[6] = SpriteLoad("Sprites/AnimatedObjects/Screen1.bmp", 4, true);
	Sprites[7] = SpriteLoad("Sprites/AnimatedObjects/Screen2.bmp", 4, true);
	Sprites[8] = SpriteLoad("Sprites/AnimatedObjects/Skull.bmp", 10, true);
	Sprites[9] = SpriteLoad("Sprites/AnimatedObjects/Transporter.bmp", 4, true);
	Sprites[10] = SpriteLoad("Sprites/AnimatedObjects/Transporter1.bmp", 4, true);
	Sprites[11] = SpriteLoad("Sprites/AnimatedObjects/Transporter2.bmp", 4, true);
	Sprites[12] = SpriteLoad("Sprites/AnimatedObjects/Transporter3.bmp", 4, true);

	for (int i = 0; i < TILE_COUNT; i++)
	{
		char Name[2048];
		sprintf(Name, "Sprites/Tiles/IndustrialTile_%d.bmp", i + 1);
		Tiles[i] = glLoadImage(Name, true);
	}
}

void MapUpdate()
{
	for (int i = 0; i < SPRITE_COUNT; i++)
		SpriteUpdate(10.0, &Sprites[i]);
}

void MapDestroy()
{
	FILE* File = fopen("Map.txt", "wb");
	fwrite(Map, 1, MapSize, File);
	fclose(File);

	for (int i = 0; i < 81; i++)
		glFreeImage(&Tiles[i]);
}